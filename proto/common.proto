syntax = "proto3";
package kagzi.v1;

import "google/protobuf/timestamp.proto";

// ============================================
// PAYLOAD - Future-proof data container
// ============================================
message Payload {
  bytes data = 1;
  map<string, string> metadata = 2;  // encoding, content-type, etc.
}

// ============================================
// PAGINATION - Standardized for all List ops
// ============================================
message PageRequest {
  int32 page_size = 1;
  string page_token = 2;
  bool include_total_count = 3;
}

message PageInfo {
  string next_page_token = 1;
  bool has_more = 2;
  int64 total_count = 3;
}

// ============================================
// ERRORS - Unified error handling
// ============================================
enum ErrorCode {
  ERROR_CODE_UNSPECIFIED = 0;
  ERROR_CODE_NOT_FOUND = 1;
  ERROR_CODE_INVALID_ARGUMENT = 2;
  ERROR_CODE_PRECONDITION_FAILED = 3;
  ERROR_CODE_CONFLICT = 4;
  ERROR_CODE_UNAUTHORIZED = 5;
  ERROR_CODE_UNAVAILABLE = 6;
  ERROR_CODE_INTERNAL = 7;
  ERROR_CODE_TIMEOUT = 8;
}

message ErrorDetail {
  ErrorCode code = 1;
  string message = 2;
  bool non_retryable = 3;
  int64 retry_after_ms = 4;
  string subject = 5;
  string subject_id = 6;
  map<string, string> metadata = 7;
}

// ============================================
// RETRY POLICY - Shared across workflows/steps
// ============================================
message RetryPolicy {
  int32 maximum_attempts = 1;
  int64 initial_interval_ms = 2;
  double backoff_coefficient = 3;
  int64 maximum_interval_ms = 4;
  repeated string non_retryable_errors = 5;
}

